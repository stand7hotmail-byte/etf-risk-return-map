<!DOCTYPE html>
<html lang="ja" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アフィリエイトダッシュボード - 管理者</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        body {
            background-color: var(--bs-secondary-bg);
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 2rem;
        }
        .stat-card {
            border-left: 4px solid;
        }
        .stat-card.clicks {
            border-left-color: #0d6efd;
        }
        .stat-card.conversions {
            border-left-color: #198754;
        }
        .stat-card.rate {
            border-left-color: #ffc107;
        }
        .stat-card.revenue {
            border-left-color: #dc3545;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-graph-up me-2"></i>アフィリエイトダッシュボード
            </a>
            <div class="ms-auto">
                <a href="/" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-house me-1"></i>ホームに戻る
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4" id="dashboard-content">
        <!-- ヘッダーセクション -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h2>パフォーマンス分析</h2>
                <p class="text-muted">アフィリエイトリンクのクリックとコンバージョンを追跡</p>
            </div>
            <div class="col-md-6 text-end">
                <label for="period-select" class="form-label me-2">期間:</label>
                <select id="period-select" class="form-select d-inline-block w-auto">
                    <option value="7d">過去7日</option>
                    <option value="30d" selected>過去30日</option>
                    <option value="90d">過去90日</option>
                </select>
            </div>
        </div>

        <!-- エラーメッセージ表示エリア -->
        <div id="error-message" class="alert alert-danger" style="display: none;" role="alert"></div>

        <!-- ローディングスピナー -->
        <div id="loading-spinner" class="text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">読み込み中...</span>
            </div>
        </div>

        <!-- サマリーカード -->
        <div class="row mb-4">
            <!-- 総クリック数 -->
            <div class="col-md-3 mb-3">
                <div class="card stat-card clicks">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">
                            <i class="bi bi-cursor-fill me-1"></i>総クリック数
                        </h6>
                        <div class="stat-value text-primary" id="total-clicks">0</div>
                    </div>
                </div>
            </div>

            <!-- 総コンバージョン数 -->
            <div class="col-md-3 mb-3">
                <div class="card stat-card conversions">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">
                            <i class="bi bi-check-circle-fill me-1"></i>総コンバージョン数
                        </h6>
                        <div class="stat-value text-success" id="total-conversions">0</div>
                    </div>
                </div>
            </div>

            <!-- 転換率 -->
            <div class="col-md-3 mb-3">
                <div class="card stat-card rate">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">
                            <i class="bi bi-percent me-1"></i>転換率
                        </h6>
                        <div class="stat-value text-warning" id="conversion-rate">0.00%</div>
                    </div>
                </div>
            </div>

            <!-- 推定収益 -->
            <div class="col-md-3 mb-3">
                <div class="card stat-card revenue">
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">
                            <i class="bi bi-currency-dollar me-1"></i>推定収益
                        </h6>
                        <div class="stat-value text-danger" id="estimated-revenue">$0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- グラフセクション -->
        <div class="row mb-4">
            <!-- クリック数推移グラフ -->
            <div class="col-md-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up me-2"></i>クリック数の推移
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="clicksChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- 証券会社別パフォーマンス -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-bar-chart me-2"></i>証券会社別クリック数
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="brokerPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 配置別クリック数 -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-pie-chart me-2"></i>配置別クリック数
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="placementChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- データテーブル -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-table me-2"></i>証券会社別詳細統計
                        </h5>
                        <button id="export-btn" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-download me-1"></i>CSVエクスポート
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="broker-table" class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>証券会社</th>
                                        <th>クリック数</th>
                                        <th>コンバージョン数</th>
                                        <th>転換率</th>
                                        <th>推定収益</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- JavaScriptで動的に生成 -->
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">データを読み込み中...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 管理者ダッシュボードJS -->
    <script src="/static/admin-dashboard.js"></script>
</body>
</html>